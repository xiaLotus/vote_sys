<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åŒ¿åæŠ•ç¥¨ç³»çµ±</title>
    <script src="static/js/package/tailwinds.js"></script>
    <script src="static/js/package/vue.global.js"></script>
    <script src="static/js/package/sweetalert2@11.js"></script>
    <style>
      [v-cloak] {
        display: none;
      }
      body {
        background: linear-gradient(
          135deg,
          #f5f0ea 0%,
          #ede4d8 50%,
          #e8dcc8 100%
        );
        overflow: hidden;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .fade-in {
        animation: fadeIn 0.5s ease-out;
      }
      .custom-scrollbar {
        scrollbar-width: thin;
        scrollbar-color: #d97706 #f3f4f6;
      }
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #f3f4f6;
        border-radius: 3px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #d97706;
        border-radius: 3px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #b45309;
      }
    </style>
  </head>
  <body class="h-screen flex items-center justify-center p-4">
    <div id="app" v-cloak class="w-full h-full">
      <!-- è¼‰å…¥ä¸­ç‹€æ…‹ -->
      <div v-if="isLoading" class="flex items-center justify-center h-full">
        <div class="bg-white rounded-2xl shadow-2xl p-8 text-center">
          <svg
            class="animate-spin h-12 w-12 text-amber-600 mx-auto mb-4"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          <p class="text-gray-600 font-semibold">è¼‰å…¥ä¸­...</p>
        </div>
      </div>

      <!-- ä¸»ç•Œé¢ -->
      <div
        v-if="!isLoading"
        class="bg-white rounded-3xl shadow-2xl overflow-hidden w-full h-full fade-in"
      >
        <div class="grid grid-cols-2 h-full">
          <!-- å·¦å´:æ­¡è¿å›ä¾† + ç›®å‰ç¥¨é¸ -->
          <div
            class="bg-gradient-to-br from-orange-700 via-red-600 to-red-700 p-6 text-white relative overflow-hidden flex flex-col"
          >
            <!-- è£é£¾åœ“åœˆ -->
            <div
              class="absolute top-0 right-0 w-48 h-48 bg-white opacity-10 rounded-full -mr-24 -mt-24"
            ></div>
            <div
              class="absolute bottom-0 left-0 w-40 h-40 bg-white opacity-10 rounded-full -ml-20 -mb-20"
            ></div>

            <div class="relative z-10 flex flex-col h-full">
              <!-- ç”¨æˆ¶è³‡è¨Š -->
              <div class="mb-4 flex-shrink-0">
                <div class="flex items-center space-x-4 mb-4">
                  <div
                    class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center"
                  >
                    <svg
                      class="w-8 h-8 text-white"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                      />
                    </svg>
                  </div>
                  <div>
                    <p class="text-white/80 text-sm">æ­¡è¿å›ä¾†</p>
                    <p class="text-2xl font-bold text-white">
                      {{ currentVoter.name }}
                    </p>
                    <div class="flex items-center space-x-2 mt-1">
                      <span class="text-sm text-white/80"
                        >å·¥è™Ÿ:{{ currentVoter.emp_id }}</span
                      >
                      <span class="text-white/60">â€¢</span>
                      <span
                        :class="currentVoter.shift_type === '2000' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'"
                        class="px-3 py-1 rounded-full text-xs font-bold"
                      >
                        {{ currentVoter.shift_type }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- æŠ•ç¥¨é™åˆ¶è­¦å‘Š -->
              <div
                v-if="!canVote"
                class="bg-red-500/20 border-l-4 border-red-300 p-3 rounded-xl mb-4 backdrop-blur-sm flex-shrink-0"
              >
                <div class="flex items-start">
                  <svg
                    class="w-6 h-6 text-red-200 mr-3 flex-shrink-0"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                    />
                  </svg>
                  <div class="flex-1">
                    <h3 class="text-base font-bold text-white mb-1">
                      â³ æŠ•ç¥¨é™åˆ¶ä¸­
                    </h3>
                    <p class="text-white/90 font-semibold text-sm">
                      {{ voteRestrictionMessage }}
                    </p>
                    <p class="text-white/80 text-xs mt-1">
                      æœ¬æœˆå·²ç”¨ {{ votesUsed }}/{{ maxVotes }} ç¥¨ â€¢ æ‚¨ä»å¯ä»¥ç€è¦½å€™é¸äººåˆ—è¡¨å’ŒæŸ¥çœ‹çµ±è¨ˆè³‡æ–™
                    </p>
                  </div>
                </div>
              </div>

              <!-- æ’è¡Œæ¦œ -->
              <div class="flex-1 flex flex-col min-h-0">
                <div class="flex items-center justify-center mb-3 flex-shrink-0">
                  <svg
                    class="w-6 h-6 mr-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                    />
                  </svg>
                  <h3 class="text-xl font-bold">ğŸ† ç›®å‰ç¥¨æ•¸æ’è¡Œ TOP 5</h3>
                </div>

                <div class="flex-1 overflow-y-auto custom-scrollbar min-h-0">
                  <div
                    v-if="leaderboard.length === 0"
                    class="text-center py-8 text-white/80"
                  >
                    ç›®å‰é‚„æ²’æœ‰æŠ•ç¥¨è¨˜éŒ„
                  </div>
                  <div v-else class="space-y-3">
                    <div
                      v-for="(item, index) in leaderboard"
                      :key="item.emp_id"
                      :class="[
                        'rounded-xl p-3 flex items-center justify-between transition-all',
                        index === 0 ? 'bg-gradient-to-r from-yellow-400 to-yellow-500 text-gray-900' :
                        index === 1 ? 'bg-gradient-to-r from-gray-300 to-gray-400 text-gray-900' :
                        index === 2 ? 'bg-gradient-to-r from-orange-400 to-orange-500 text-white' :
                        'bg-white/20 backdrop-blur text-white'
                      ]"
                    >
                      <div class="flex items-center space-x-3">
                        <div
                          class="w-10 h-10 bg-white/30 rounded-full flex items-center justify-center font-bold text-lg"
                        >
                          {{ index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : index + 1 }}
                        </div>
                        <div>
                          <p class="font-bold">{{ item.name }}</p>
                          <p class="text-sm opacity-80">{{ item.emp_id }}</p>
                        </div>
                      </div>
                      <div class="bg-white/30 px-3 py-1 rounded-full font-bold">
                        {{ item.vote_count }} ç¥¨
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- å³å´:æŠ•ç¥¨åŸŸåŸŸ -->
          <div
            class="p-5 flex flex-col h-full relative"
            style="background: linear-gradient(to bottom, #fffbf5, #fff7ed)"
          >
            <!-- é›¢é–‹æŒ‰éˆ• -->
            <button
              @click="logout"
              class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 font-semibold z-10 transition-colors"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                />
              </svg>
            </button>

            <!-- æŠ•ç¥¨è³‡è¨Š - å›ºå®š -->
            <div
              class="bg-amber-50 border-l-4 border-amber-500 p-2.5 rounded-lg mb-2.5 flex-shrink-0"
            >
              <div class="flex items-center flex-wrap gap-x-3 gap-y-1.5 text-xs mb-2">
                <div class="flex items-center space-x-1.5">
                  <span class="font-bold text-gray-700">æ‚¨çš„èº«ä»½:</span>
                  <span
                    :class="currentVoter.shift_type === '2000' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'"
                    class="px-2.5 py-0.5 rounded-full font-bold"
                    >{{ currentVoter.shift_type }}</span
                  >
                </div>
                <span class="text-gray-400">â€¢</span>
                <div class="flex items-center space-x-1.5">
                  <span class="font-bold text-gray-700">å¯æŠ•ç¥¨å°è±¡:</span>
                  <span class="text-amber-600 font-bold"
                    >{{ displayTargetShift }}</span
                  >
                </div>
                <span class="text-gray-400">â€¢</span>
                <div class="flex items-center space-x-1.5">
                  <span class="font-bold text-gray-700">å€™é¸äººæ•¸é‡:</span>
                  <span class="text-amber-600 font-bold"
                    >{{ candidates.length }} ä½</span
                  >
                </div>
              </div>
              
              <!-- æŠ•ç¥¨é€²åº¦æ¢ -->
              <div class="flex items-center space-x-2">
                <span class="text-xs font-bold text-gray-700 whitespace-nowrap">æŠ•ç¥¨é€²åº¦:</span>
                <div class="flex-1 bg-gray-200 rounded-full h-5 overflow-hidden">
                  <div 
                    :style="{ width: (votesUsed / maxVotes * 100) + '%' }"
                    :class="votesUsed === maxVotes ? 'bg-green-500' : 'bg-amber-500'"
                    class="h-full flex items-center justify-center transition-all duration-500"
                  >
                    <span v-if="votesUsed > 0" class="text-white text-xs font-bold px-2">
                      {{ votesUsed }}/{{ maxVotes }}
                    </span>
                  </div>
                </div>
                <span class="text-xs font-bold whitespace-nowrap" :class="votesUsed === maxVotes ? 'text-green-600' : 'text-amber-600'">
                  {{ votesUsed === maxVotes ? 'âœ“ å·²å®Œæˆ' : `å‰© ${maxVotes - votesUsed} ç¥¨` }}
                </span>
              </div>
            </div>

            <!-- æœå°‹å€™é¸äºº - å›ºå®š -->
            <div class="mb-2 flex-shrink-0">
              <div class="relative">
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                >
                  <svg
                    class="w-5 h-5 text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    />
                  </svg>
                </div>
                <input
                  type="text"
                  v-model="candidateSearch"
                  placeholder="æœå°‹å€™é¸äººå§“åæˆ–å·¥è™Ÿ..."
                  class="w-full pl-11 pr-3 py-2 border-2 border-gray-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 focus:outline-none transition-all text-sm"
                />
              </div>
            </div>

            <!-- å€™é¸äººè¨ˆæ•¸æç¤º - å›ºå®š -->
            <div class="text-xs text-gray-600 mb-1.5 flex-shrink-0 flex items-center justify-between">
              <span>
                é¡¯ç¤º <span class="font-bold text-amber-600">{{ paginatedCandidates.length }}</span> / 
                <span class="font-bold">{{ filteredCandidates.length }}</span> ä½å€™é¸äºº
                <span v-if="selectedCandidates.length > 0" class="ml-2 text-green-600 font-bold">
                  (å·²é¸ {{ selectedCandidates.length }}/{{ remainingVotes }} ä½)
                </span>
              </span>
              <span v-if="totalPages > 1" class="text-xs text-gray-500">
                (ç¬¬ {{ currentPage }}/{{ totalPages }} é )
              </span>
            </div>

            <!-- å€™é¸äººåˆ—è¡¨å®¹å™¨ - ä½¿ç”¨ flex-1 ä¸¦è¨­ç½®æœ€å°é«˜åº¦ç‚º 0 -->
            <div class="flex-1 overflow-hidden mb-1.5 min-h-0">
              <div class="h-full overflow-y-auto custom-scrollbar pr-1">
                <div class="space-y-1.5">
                  <!-- ç©ºç‹€æ…‹ -->
                  <div
                    v-if="paginatedCandidates.length === 0"
                    class="text-center py-8 text-gray-400"
                  >
                    <svg
                      class="w-12 h-12 mx-auto mb-3"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                    <p class="text-sm">æ‰¾ä¸åˆ°ç¬¦åˆçš„å€™é¸äºº</p>
                  </div>
                  
                  <!-- å€™é¸äººå¡ç‰‡ -->
                  <div
                    v-for="(candidate, index) in paginatedCandidates"
                    :key="candidate.emp_id"
                    @click="canVote ? selectCandidate(candidate) : null"
                    :class="{
                      'border-amber-500 bg-amber-50 shadow-lg': selectedCandidates.some(c => c.emp_id === candidate.emp_id) && canVote,
                      'border-gray-200 hover:border-amber-300 hover:bg-amber-50/50': !selectedCandidates.some(c => c.emp_id === candidate.emp_id) && canVote,
                      'border-gray-200 opacity-60 cursor-not-allowed': !canVote,
                      'cursor-pointer': canVote
                    }"
                    class="border-2 rounded-lg p-2 transition-all duration-200"
                  >
                    <div class="flex items-center justify-between">
                      <div class="flex items-center space-x-2 flex-1 min-w-0">
                        <div
                          :class="selectedCandidates.some(c => c.emp_id === candidate.emp_id) && canVote ? 'bg-amber-600 text-white ring-4 ring-amber-200' : 'bg-gray-200 text-gray-700'"
                          class="w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm transition-all flex-shrink-0"
                        >
                          {{ (currentPage - 1) * itemsPerPage + index + 1 }}
                        </div>
                        <div class="flex-1 min-w-0">
                          <p class="font-bold text-gray-800 truncate text-sm">
                            {{ candidate.name }}
                          </p>
                          <p class="text-xs text-gray-500">
                            {{ candidate.emp_id }}
                          </p>
                        </div>
                      </div>
                      <div class="flex items-center space-x-2 flex-shrink-0">
                        <span
                          :class="candidate.shift_type === '2000' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'"
                          class="px-2 py-0.5 rounded-full text-xs font-bold"
                        >
                          {{ candidate.shift_type }}
                        </span>
                        <svg
                          v-if="selectedCandidates.some(c => c.emp_id === candidate.emp_id) && canVote"
                          class="w-6 h-6 text-amber-600 flex-shrink-0"
                          fill="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                          />
                        </svg>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- åˆ†é æ§åˆ¶ - å›ºå®š -->
            <div
              v-if="totalPages > 1"
              class="flex items-center justify-center space-x-2.5 mb-1.5 pb-1.5 border-b-2 border-gray-200 flex-shrink-0"
            >
              <button
                @click="currentPage--"
                :disabled="currentPage === 1"
                class="px-3 py-1.5 bg-white border-2 border-amber-600 text-amber-600 rounded-lg font-bold disabled:border-gray-300 disabled:text-gray-300 disabled:cursor-not-allowed hover:bg-amber-600 hover:text-white transition-all text-xs"
              >
                â† ä¸Šä¸€é 
              </button>
              <span class="text-gray-700 font-bold px-2.5 text-xs bg-amber-50 py-1.5 rounded-lg border border-amber-200">
                ç¬¬ {{ currentPage }}/{{ totalPages }} é 
              </span>
              <button
                @click="currentPage++"
                :disabled="currentPage === totalPages"
                class="px-3 py-1.5 bg-white border-2 border-amber-600 text-amber-600 rounded-lg font-bold disabled:border-gray-300 disabled:text-gray-300 disabled:cursor-not-allowed hover:bg-amber-600 hover:text-white transition-all text-xs"
              >
                ä¸‹ä¸€é  â†’
              </button>
            </div>

            <!-- é¸æ“‡æç¤º + æŠ•ç¥¨æŒ‰éˆ•åŸŸåŸŸ - å›ºå®šåœ¨åº•éƒ¨ -->
            <div class="flex-shrink-0 space-y-2.5 pt-1">
              <!-- é¸æ“‡çš„å€™é¸äººæç¤º - ç²¾ç°¡ç‰ˆï¼Œåªé¡¯ç¤º1ä½ -->
              <div
                v-if="selectedCandidates.length > 0 && canVote"
                class="bg-gradient-to-r from-green-50 to-amber-50 rounded-lg border-2 border-amber-300 shadow-sm"
              >
                <!-- æ¨™é¡Œæ¬„ - ç·Šæ¹Š -->
                <div class="px-2 py-1 border-b border-amber-200">
                  <div class="flex items-center justify-between">
                    <span class="text-xs font-bold text-gray-700">
                      å·²é¸ {{ selectedCandidates.length }}/{{ remainingVotes }}
                    </span>
                    <button 
                      @click="selectedCandidates = []"
                      class="text-xs text-red-500 hover:text-red-700 font-semibold hover:underline">
                      æ¸…ç©º
                    </button>
                  </div>
                </div>
                
                <!-- å€™é¸äººåˆ—è¡¨ - åªé¡¯ç¤º1è¡Œï¼Œå…¶é¤˜æ»¾å‹• -->
                <div class="px-2 py-1 space-y-1 overflow-y-auto custom-scrollbar" style="max-height: 40px;">
                  <div v-for="(candidate, index) in selectedCandidates" :key="candidate.emp_id"
                       class="flex items-center justify-between bg-white px-2 py-1 rounded hover:bg-gray-50 transition-colors">
                    <span class="text-xs font-bold text-gray-800 flex-1 truncate">
                      {{ index + 1 }}. {{ candidate.name }} ({{ candidate.emp_id }})
                    </span>
                    <button 
                      @click.stop="selectCandidate(candidate)"
                      class="text-red-500 hover:text-red-700 text-xs px-1 hover:bg-red-50 rounded transition-colors ml-1 flex-shrink-0"
                      title="å–æ¶ˆé¸æ“‡">
                      âœ•
                    </button>
                  </div>
                </div>
              </div>

              <!-- æ“ä½œæŒ‰éˆ• -->
              <div class="flex space-x-2.5">
                <button
                  @click="submitVote"
                  :disabled="selectedCandidates.length === 0 || !canVote"
                  class="flex-1 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-xl font-bold text-base shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <svg
                    class="w-5 h-5 inline mr-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  {{ canVote ? (selectedCandidates.length > 0 ? `ç¢ºèªæŠ•ç¥¨ (${selectedCandidates.length})` : 'è«‹é¸æ“‡å€™é¸äºº') : 'æŠ•ç¥¨åŠŸèƒ½å·²é–å®š' }}
                </button>

                <button
                  @click="goToAdmin"
                  class="px-5 py-3 bg-white border-2 border-amber-600 text-amber-600 rounded-xl font-bold text-base hover:bg-amber-600 hover:text-white transition-all shadow-md hover:shadow-lg"
                >
                  <svg
                    class="w-5 h-5 inline mr-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                    />
                  </svg>
                  æŸ¥çœ‹çµ±è¨ˆ
                </button>
              </div>

              <!-- éŒ¯èª¤è¨Šæ¯ -->
              <div
                v-if="errorMessage"
                class="bg-red-50 border-l-4 border-red-500 p-2.5 rounded-lg shadow-sm"
              >
                <div class="flex items-center">
                  <svg
                    class="w-5 h-5 text-red-500 mr-2 flex-shrink-0"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  <p class="text-red-800 font-semibold text-xs">{{ errorMessage }}</p>
                </div>
              </div>
            </div>
          </div>
          <!-- å³å´çµæŸ -->
        </div>
      </div>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            isLoading: true,
            empId: "",
            currentVoter: {
              emp_id: "",
              name: "",
              shift_type: "",
            },
            candidates: [],
            filteredCandidates: [],
            candidateSearch: "",
            selectedCandidates: [], // æ”¹ç‚ºé™£åˆ—ä»¥æ”¯æŒå¤šé¸
            targetShift: "",
            errorMessage: "",
            leaderboard: [],
            currentPage: 1,
            itemsPerPage: 8,
            canVote: true,
            voteRestrictionMessage: "",
            votesUsed: 0,
            maxVotes: 1,
          };
        },
        computed: {
          totalPages() {
            return Math.ceil(
              this.filteredCandidates.length / this.itemsPerPage
            );
          },
          paginatedCandidates() {
            const start = (this.currentPage - 1) * this.itemsPerPage;
            const end = start + this.itemsPerPage;
            return this.filteredCandidates.slice(start, end);
          },
          remainingVotes() {
            return this.maxVotes - this.votesUsed;
          },
          canSelectMore() {
            return this.selectedCandidates.length < this.remainingVotes;
          },
          selectedCount() {
            return this.selectedCandidates.length;
          },
          displayTargetShift() {
            // targetShift åŸå§‹å€¼ä»æ˜¯ 'RR'/'è¼ªç­'ï¼ˆå› ä¾†è‡ª check_status API çš„ shift_typeï¼‰
            // ä½†ç‚ºäº†å®‰å…¨ï¼Œä¹Ÿæ”¯æ´æ–°å€¼
            const map = { 'RR': '2000', 'è¼ªç­': '3000', '2000': '2000', '3000': '3000' };
            return map[this.targetShift] || this.targetShift;
          }
        },
        watch: {
          candidateSearch(val) {
            const search = val.toLowerCase();
            this.filteredCandidates = this.candidates.filter(
              (c) =>
                c.name.toLowerCase().includes(search) ||
                c.emp_id.toLowerCase().includes(search)
            );
            this.currentPage = 1;
            if (this.canVote) {
              this.selectedCandidates = [];
            }
          },
        },

        async mounted() {
          console.log('=== Vue mounted é–‹å§‹ ===');
          const urlParams = new URLSearchParams(window.location.search);
          const empId = urlParams.get("emp_id");

          console.log('URL åƒæ•¸ emp_id:', empId);

          if (!empId) {
            console.error('âŒ æ²’æœ‰ emp_id åƒæ•¸ï¼Œè·³è½‰åˆ°ç™»å…¥é ');
            window.location.href = "login.html";
            return;
          }

          this.empId = empId;
          console.log('è¨­ç½® this.empId:', this.empId);
          
          console.log('é–‹å§‹åŸ·è¡Œ loadData...');
          await this.loadData();
          console.log('loadData åŸ·è¡Œå®Œæˆ');
          console.log('Vue å·²æ›è¼‰ï¼ŒcurrentVoter:', this.currentVoter);
        },

        methods: {
          // æœˆåº¦æŠ•ç¥¨è¼”åŠ©å‡½æ•¸
          getCurrentYearMonth() {
            const now = new Date();
            return { year: now.getFullYear(), month: now.getMonth() + 1 };
          },
          
          async loadData() {
            const empId = this.empId.toUpperCase();
            console.log('=== loadData é–‹å§‹ ===');
            console.log('empId:', empId);

            try {
              const { year, month } = this.getCurrentYearMonth();
              console.log('æŸ¥è©¢å¹´æœˆ:', year, month);
              
              const statusUrl = `http://127.0.0.1:5000/api/check_status/${empId}?year=${year}&month=${month}`;
              console.log('è«‹æ±‚ URL:', statusUrl);
              
              const statusResponse = await fetch(statusUrl);
              console.log('ç‹€æ…‹éŸ¿æ‡‰:', statusResponse.status, statusResponse.ok);
              
              const statusData = await statusResponse.json();
              console.log('ç‹€æ…‹æ•¸æ“š:', statusData);

              if (!statusResponse.ok) {
                console.error('âŒ ç‹€æ…‹æª¢æŸ¥å¤±æ•—ï¼Œè·³è½‰åˆ°ç™»å…¥é ');
                window.location.href = "login.html";
                return;
              }

              console.log('è¨­ç½® currentVoter...');
              this.currentVoter = {
                emp_id: empId,
                name: statusData.name,
                shift_type: statusData.shift_type,
              };
              console.log('currentVoter å·²è¨­ç½®:', this.currentVoter);
              
              this.targetShift = statusData.shift_type === "2000" ? "3000" : "2000";
              console.log('ç›®æ¨™ç­åˆ¥:', this.targetShift);

              const { year: year2, month: month2 } = this.getCurrentYearMonth();
              const empResponse = await fetch(
                `http://127.0.0.1:5000/api/employees?year=${year2}&month=${month2}`
              );
              const employees = await empResponse.json();
              console.log('å“¡å·¥ç¸½æ•¸:', employees.length);
              
              this.candidates = employees.filter(
                (e) => e.shift_type === this.targetShift
              );
              console.log('å€™é¸äººæ•¸é‡:', this.candidates.length);
              
              this.filteredCandidates = this.candidates;

              if (statusData.can_vote) {
                this.canVote = true;
                this.voteRestrictionMessage = "";
                this.votesUsed = statusData.votes_used || 0;
                this.maxVotes = statusData.max_votes || 1;
                console.log('âœ… å¯ä»¥æŠ•ç¥¨ï¼Œå·²ç”¨:', this.votesUsed, 'é…é¡:', this.maxVotes);
              } else {
                this.canVote = false;
                this.voteRestrictionMessage =
                  statusData.message || "æŠ•ç¥¨åŠŸèƒ½æš«æ™‚ç„¡æ³•ä½¿ç”¨";
                this.votesUsed = statusData.votes_used || 0;
                this.maxVotes = statusData.max_votes || 1;
                console.log('âŒ ç„¡æ³•æŠ•ç¥¨:', this.voteRestrictionMessage);
              }

              await this.loadStatistics();
              this.isLoading = false;
              console.log('=== loadData å®Œæˆ ===');
            } catch (error) {
              console.error("âŒ loadData å¤±æ•—:", error);
              console.error("éŒ¯èª¤å †ç–Š:", error.stack);
              alert('è¼‰å…¥å¤±æ•—ï¼š' + error.message + '\nå³å°‡è¿”å›ç™»å…¥é ');
              window.location.href = "login.html";
            }
          },

          logout() {
            if (confirm("ç¢ºå®šè¦ç™»å‡ºå—?")) {
              window.location.href = "login.html";
            }
          },

        goToAdmin() {
          console.log('=== é»æ“ŠæŸ¥çœ‹çµ±è¨ˆæŒ‰éˆ• ===');
          console.log('1. this.empId:', this.empId);
          console.log('2. this.currentVoter:', this.currentVoter);
          
          // å„ªå…ˆä½¿ç”¨ currentVoter.emp_idï¼Œå¦‚æœæ²’æœ‰å°±ç”¨ this.empId
          const empId = this.currentVoter?.emp_id || this.empId;
          console.log('3. ä½¿ç”¨çš„ empId:', empId);
          
          if (!empId) {
            console.error('âŒ ç„¡æ³•ç²å– emp_id');
            alert('ç³»çµ±éŒ¯èª¤ï¼šç„¡æ³•ç²å–ç”¨æˆ¶è³‡è¨Šï¼Œè«‹é‡æ–°ç™»å…¥');
            window.location.href = 'login.html';
            return;
          }
          
          const targetUrl = `admin_panel.html?emp_id=${empId}`;
          console.log('4. è·³è½‰ç›®æ¨™:', targetUrl);
          console.log('5. åŸ·è¡Œè·³è½‰...');
          
          window.location.href = targetUrl;
        },

          selectCandidate(candidate) {
            if (!this.canVote) return;
            
            const index = this.selectedCandidates.findIndex(c => c.emp_id === candidate.emp_id);
            
            if (index > -1) {
              // å¦‚æœå·²ç¶“é¸æ“‡ï¼Œå‰‡å–æ¶ˆé¸æ“‡
              this.selectedCandidates.splice(index, 1);
              this.errorMessage = '';
            } else {
              // å¦‚æœæœªé¸æ“‡ï¼Œæª¢æŸ¥æ˜¯å¦é‚„èƒ½é¸æ“‡æ›´å¤š
              if (this.canSelectMore) {
                this.selectedCandidates.push(candidate);
                this.errorMessage = '';
              } else {
                this.errorMessage = `æœ€å¤šåªèƒ½é¸æ“‡ ${this.remainingVotes} ä½å€™é¸äºº`;
                setTimeout(() => {
                  this.errorMessage = '';
                }, 3000);
              }
            }
          },
          async submitVote() {
            // æª¢æŸ¥æ—¥æœŸé™åˆ¶ï¼ˆæ¯æœˆ10-18è™Ÿæ‰èƒ½æŠ•ç¥¨ï¼‰
            const today = new Date().getDate();
            if (today < 10 || today > 18) {
              Swal.fire({
                title: "â³ æŠ•ç¥¨æœŸé–“é™åˆ¶",
                html: `æŠ•ç¥¨æœŸé–“ç‚ºæ¯æœˆ <strong>10-18 è™Ÿ</strong><br><br>ä»Šå¤©æ˜¯ <strong class="text-2xl text-red-600">${today} è™Ÿ</strong><br><br>è«‹æ–¼æŠ•ç¥¨æœŸé–“å…§å†ä¾†æŠ•ç¥¨`,
                icon: "warning",
                confirmButtonColor: "#d97706",
                confirmButtonText: "çŸ¥é“äº†",
                customClass: {
                  popup: "rounded-2xl",
                  confirmButton: "rounded-lg px-6 py-3",
                },
              });
              return;
            }
            if (!this.canVote) {
              this.errorMessage = this.voteRestrictionMessage;
              return;
            }

            if (this.selectedCandidates.length === 0) {
              this.errorMessage = "è«‹è‡³å°‘é¸æ“‡ä¸€ä½å€™é¸äºº";
              return;
            }

            // ç”Ÿæˆå€™é¸äººåå–®çš„ HTML
            const candidatesList = this.selectedCandidates
              .map((c, i) => `${i + 1}. <strong>${c.name}</strong> (${c.emp_id})`)
              .join('<br>');

            const result = await Swal.fire({
              title: "ç¢ºèªæŠ•ç¥¨",
              html: `ç¢ºå®šè¦æŠ•ç¥¨çµ¦ä»¥ä¸‹ <strong class="text-2xl text-amber-600">${this.selectedCandidates.length}</strong> ä½å€™é¸äººå—?<br><br>
                    <div class="text-left bg-amber-50 p-4 rounded-lg my-3">
                      ${candidatesList}
                    </div>
                    <span class="text-red-600">âš ï¸ æŠ•ç¥¨å¾Œç„¡æ³•ä¿®æ”¹!</span>`,
              icon: "question",
              showCancelButton: true,
              confirmButtonColor: "#4F46E5",
              cancelButtonColor: "#6B7280",
              confirmButtonText: "ç¢ºèªæŠ•ç¥¨",
              cancelButtonText: "å–æ¶ˆ",
              customClass: {
                popup: "rounded-2xl",
                confirmButton: "rounded-lg px-6 py-3",
                cancelButton: "rounded-lg px-6 py-3",
              },
            });

            if (!result.isConfirmed) {
              return;
            }

            try {
              const { year, month } = this.getCurrentYearMonth();
              const response = await fetch("http://127.0.0.1:5000/api/vote", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  voter_emp_id: this.currentVoter.emp_id,
                  voted_for_emp_ids: this.selectedCandidates.map(c => c.emp_id),
                  year: year,
                  month: month,
                }),
              });

              const data = await response.json();

              if (response.ok) {
                // ç›´æ¥ä½¿ç”¨å¾Œç«¯è¿”å›çš„ç¥¨æ•¸
                this.votesUsed = data.votes_used;
                this.maxVotes = data.max_votes;
                const remainingVotes = this.maxVotes - this.votesUsed;
                
                console.log('æŠ•ç¥¨æˆåŠŸï¼švotes_used:', this.votesUsed, 'max_votes:', this.maxVotes, 'remaining:', remainingVotes);
                
                // é¡¯ç¤ºæŠ•ç¥¨æˆåŠŸè¨Šæ¯
                await Swal.fire({
                  title: "âœ… æŠ•ç¥¨æˆåŠŸ!",
                  html: `æ„Ÿè¬æ‚¨çš„åƒèˆ‡<br><br>æ‚¨å·²æˆåŠŸæŠ•å‡º <strong class="text-amber-600">${this.selectedCandidates.length}</strong> ç¥¨<br>
                        æœ¬æœˆå·²ä½¿ç”¨ <strong class="text-amber-600">${this.votesUsed}/${this.maxVotes}</strong> ç¥¨`,
                  icon: "success",
                  timer: 2000,
                  showConfirmButton: false,
                  customClass: {
                    popup: "rounded-2xl",
                  },
                });

                // æ¸…ç©ºé¸æ“‡
                this.selectedCandidates = [];
                this.errorMessage = "";

                // æª¢æŸ¥æ˜¯å¦é‚„æœ‰å‰©é¤˜ç¥¨æ•¸
                if (remainingVotes > 0) {
                  // âœ… æ”¹ç”¨ preConfirm ç¢ºä¿è·³è½‰åŸ·è¡Œ
                  const continueResult = await Swal.fire({
                    title: "ğŸ“Š é‚„æœ‰å‰©é¤˜ç¥¨æ•¸",
                    html: `æ‚¨æœ¬æœˆé‚„æœ‰ <strong class="text-2xl text-amber-600">${remainingVotes}</strong> ç¥¨å¯ä»¥æŠ•<br><br>
                          <div class="text-gray-600 text-sm mt-3">
                            <p>ğŸ’¡ æ‚¨å¯ä»¥é¸æ“‡ï¼š</p>
                            <p class="mt-2">â€¢ <strong>æŸ¥çœ‹çµ±è¨ˆ</strong>ï¼šå‰å¾€çµ±è¨ˆé é¢æŸ¥çœ‹æŠ•ç¥¨çµæœ</p>
                            <p>â€¢ <strong>ç¹¼çºŒæŠ•ç¥¨</strong>ï¼šç‚ºå…¶ä»–å€™é¸äººæŠ•ç¥¨</p>
                          </div>`,
                    icon: "info",
                    showCancelButton: true,
                    showDenyButton: false,
                    confirmButtonColor: "#f59e0b",
                    cancelButtonColor: "#6366f1",
                    confirmButtonText: "ğŸ“Š æŸ¥çœ‹çµ±è¨ˆ",
                    cancelButtonText: "ğŸ—³ï¸ ç¹¼çºŒæŠ•ç¥¨",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    customClass: {
                      popup: "rounded-2xl",
                      confirmButton: "rounded-lg px-6 py-3",
                      cancelButton: "rounded-lg px-6 py-3",
                    },
                  });

                  console.log('ç”¨æˆ¶é¸æ“‡çµæœ:', continueResult);

                  // âœ… æ˜ç¢ºè™•ç†å…©ç¨®æƒ…æ³
                  if (continueResult.isConfirmed) {
                    // æŸ¥çœ‹çµ±è¨ˆ - ç«‹å³è·³è½‰
                    console.log('=== ç”¨æˆ¶é¸æ“‡æŸ¥çœ‹çµ±è¨ˆ ===');
                    const targetUrl = `admin_panel.html?emp_id=${this.currentVoter.emp_id}`;
                    console.log('è·³è½‰ç›®æ¨™:', targetUrl);
                    setTimeout(() => {
                      window.location.href = targetUrl;
                    }, 300);
                  } else {
                    // ç¹¼çºŒæŠ•ç¥¨
                    console.log('=== ç”¨æˆ¶é¸æ“‡ç¹¼çºŒæŠ•ç¥¨ ===');
                    await this.loadData();
                    this.canVote = true;
                    
                    Swal.fire({
                      title: "ç¹¼çºŒæŠ•ç¥¨",
                      text: `è«‹é¸æ“‡æ‚¨è¦æŠ•ç¥¨çš„å€™é¸äºº (å‰©é¤˜ ${remainingVotes} ç¥¨)`,
                      icon: "success",
                      timer: 1500,
                      showConfirmButton: false,
                      customClass: {
                        popup: "rounded-2xl",
                      },
                    });
                  }
                } else {
                  // å·²ç”¨å®Œæ‰€æœ‰ç¥¨æ•¸ï¼Œå‰å¾€çµ±è¨ˆé é¢
                  console.log('=== æ‰€æœ‰ç¥¨æ•¸å·²ç”¨å®Œ ===');
                  await Swal.fire({
                    title: "ğŸ‰ å·²æŠ•å®Œæ‰€æœ‰ç¥¨æ•¸!",
                    text: "æ‚¨æœ¬æœˆçš„æŠ•ç¥¨é…é¡å·²ç”¨å®Œï¼Œå³å°‡å‰å¾€çµ±è¨ˆé é¢",
                    icon: "success",
                    timer: 2000,
                    showConfirmButton: false,
                    allowOutsideClick: false,
                    customClass: {
                      popup: "rounded-2xl",
                    },
                  });
                  
                  // å¼·åˆ¶è·³è½‰
                  setTimeout(() => {
                    const targetUrl = `admin_panel.html?emp_id=${this.currentVoter.emp_id}`;
                    console.log('å¼·åˆ¶è·³è½‰åˆ°:', targetUrl);
                    window.location.href = targetUrl;
                  }, 300);
                }
              } else {
                this.errorMessage = data.error;

                Swal.fire({
                  title: "æŠ•ç¥¨å¤±æ•—",
                  text: data.error,
                  icon: "error",
                  confirmButtonColor: "#4F46E5",
                  confirmButtonText: "ç¢ºå®š",
                  customClass: {
                    popup: "rounded-2xl",
                    confirmButton: "rounded-lg px-6 py-3",
                  },
                });
              }
            } catch (error) {
              console.error("æŠ•ç¥¨éŒ¯èª¤:", error);
              this.errorMessage = "æŠ•ç¥¨å¤±æ•—,è«‹ç¨å¾Œå†è©¦";

              Swal.fire({
                title: "ç³»çµ±éŒ¯èª¤",
                text: "æŠ•ç¥¨å¤±æ•—,è«‹ç¨å¾Œå†è©¦",
                icon: "error",
                confirmButtonColor: "#4F46E5",
                confirmButtonText: "ç¢ºå®š",
                customClass: {
                  popup: "rounded-2xl",
                  confirmButton: "rounded-lg px-6 py-3",
                },
              });
            }
          },
          async loadStatistics() {
            try {
              const response = await fetch(
                "http://127.0.0.1:5000/api/statistics"
              );
              const data = await response.json();

              // å°‡targetShiftè½‰æ›ç‚ºå¾Œç«¯ä½¿ç”¨çš„æ ¼å¼
              const shiftMap = {
                '2000': 'RR',
                '3000': 'è¼ªç­',
                'RR': 'RR',
                'è¼ªç­': 'è¼ªç­'
              };
              const targetShiftFormatted = shiftMap[this.targetShift] || this.targetShift;
              
              console.log('éæ¿¾æ¢ä»¶:', 'targetShift =', this.targetShift, '->', targetShiftFormatted);
              console.log('åŸå§‹çµ±è¨ˆæ•¸æ“š:', data.vote_stats);

              this.leaderboard = data.vote_stats
                .filter((stat) => stat.shift_type === targetShiftFormatted)
                .slice(0, 5);
              
              console.log('éæ¿¾å¾Œçš„æ’è¡Œæ¦œ:', this.leaderboard);
            } catch (error) {
              console.error("è¼‰å…¥çµ±è¨ˆå¤±æ•—", error);
            }
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>